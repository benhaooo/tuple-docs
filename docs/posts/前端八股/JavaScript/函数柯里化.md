# å‡½æ•°æŸ¯é‡ŒåŒ– (Function Currying)

-----

## ğŸ“– ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ– (What is Function Currying?)

**å‡½æ•°æŸ¯é‡ŒåŒ– (Currying)** æ˜¯å‡½æ•°å¼ç¼–ç¨‹ (Functional Programming) ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚

å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å°†ä¸€ä¸ªæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè½¬æ¢æˆä¸€ç³»åˆ—åªæ¥æ”¶ä¸€ä¸ªå‚æ•°çš„å‡½æ•°**ã€‚

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤šå‚æ•°å‡½æ•° `f(a, b, c)` æ‹†åˆ†æˆ `f(a)(b)(c)` çš„å½¢å¼ã€‚æ¯æ¬¡è°ƒç”¨åªä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç­‰å¾…æ¥æ”¶ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œç›´åˆ°æ‰€æœ‰å‚æ•°éƒ½æ¥æ”¶å®Œæ¯•ï¼Œæœ€åè¿”å›æœ€ç»ˆçš„è®¡ç®—ç»“æœã€‚

è¿™ä¸ªæŠ€æœ¯ä»¥é€»è¾‘å­¦å®¶ **Haskell Curry** çš„åå­—å‘½åã€‚

> **æ ¸å¿ƒå®šä¹‰**ï¼šæŠŠæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå˜æ¢æˆæ¥æ”¶ä¸€ä¸ªå•ä¸€å‚æ•°çš„ï¼ˆå¹¶è¿”å›æ–°å‡½æ•°çš„ï¼‰å‡½æ•°ã€‚

-----

## ğŸš€ å¿«é€Ÿå…¥é—¨ç¤ºä¾‹ (Quick Start Example)

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œå°†ä¸€ä¸ªæ¥æ”¶ä¸¤ä¸ªæ•°å­—å¹¶æ±‚å’Œçš„å‡½æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–ã€‚

#### æŸ¯é‡ŒåŒ–å‰

è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ¥æ”¶å¤šå‚æ•°çš„å‡½æ•°ã€‚

```javascript
// æ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°
function add(x, y) {
  return x + y;
}

console.log(add(1, 2)); // è¾“å‡º: 3
```

#### æŸ¯é‡ŒåŒ–å

æŸ¯é‡ŒåŒ–åï¼Œå‡½æ•°æ¯æ¬¡åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°æ¥æ¥æ”¶ä¸‹ä¸€ä¸ªå‚æ•°ã€‚

```javascript
// æŸ¯é‡ŒåŒ–åçš„å‡½æ•°
function curriedAdd(x) {
  // è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œåˆ©ç”¨é—­åŒ…è®°ä½äº† x çš„å€¼
  return function(y) {
    return x + y;
  };
}

const add1 = curriedAdd(1); // å›ºå®šäº†ç¬¬ä¸€ä¸ªå‚æ•°ä¸º 1ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°
const result = add1(2);    // ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•° 2

console.log(result); // è¾“å‡º: 3

// ä¹Ÿå¯ä»¥é“¾å¼è°ƒç”¨
console.log(curriedAdd(1)(2)); // è¾“å‡º: 3
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`curriedAdd` åˆ©ç”¨äº† **é—­åŒ…** çš„ç‰¹æ€§ã€‚å½“ `curriedAdd(1)` è¢«è°ƒç”¨æ—¶ï¼Œå†…éƒ¨å‡½æ•°è®°ä½äº†å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„ `x` çš„å€¼ï¼ˆå³ `1`ï¼‰ï¼Œå¹¶è¢«è¿”å›ã€‚å½“è¿™ä¸ªè¿”å›çš„å‡½æ•°å†æ¬¡è¢«è°ƒç”¨å¹¶ä¼ å…¥ `2` æ—¶ï¼Œå®ƒå°±å¯ä»¥è®¿é—®ä¹‹å‰ä¿å­˜çš„ `x` å¹¶å®Œæˆ `x + y` çš„è®¡ç®—ã€‚

-----

## ğŸ› ï¸ æŸ¯é‡ŒåŒ–çš„å®é™…åº”ç”¨ (Practical Applications of Currying)

æŸ¯é‡ŒåŒ–æœ€å¤§çš„å¥½å¤„æ˜¯ **å‚æ•°å¤ç”¨** (æˆ–ç§° **å›ºå®šå‚æ•°**)ï¼Œå®ƒå…è®¸æˆ‘ä»¬åˆ›å»ºæ›´ä¸“ä¸šã€æ›´å…·ä½“çš„å‡½æ•°ã€‚

### 1\. å‚æ•°å¤ç”¨ (Parameter Reuse)

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œè€Œå…¶ä¸­æŸäº›å‚æ•°æ˜¯å›ºå®šçš„ã€‚æŸ¯é‡ŒåŒ–å¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…é‡å¤ä¼ é€’è¿™äº›ç›¸åŒçš„å‚æ•°ã€‚

**åœºæ™¯**ï¼šåˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæŸä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚

#### éæŸ¯é‡ŒåŒ–å®ç°

æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦åŒæ—¶ä¼ å…¥æ­£åˆ™è¡¨è¾¾å¼å’Œå¾…éªŒè¯çš„å­—ç¬¦ä¸²ã€‚

```javascript
function check(reg, str) {
  return reg.test(str);
}

check(/\d+/g, 'test'); // false
check(/\d+/g, '123');  // true
check(/\d+/g, '456');  // true
// æ­£åˆ™è¡¨è¾¾å¼è¢«é‡å¤ä¼ é€’
```

#### æŸ¯é‡ŒåŒ–å®ç°

æˆ‘ä»¬å¯ä»¥å…ˆå›ºå®šæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”Ÿæˆä¸€ä¸ªä¸“é—¨ç”¨äºæ•°å­—éªŒè¯çš„æ–°å‡½æ•°ã€‚

```javascript
function curriedCheck(reg) {
  return function(str) {
    return reg.test(str);
  }
}

// å›ºå®šæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºæ£€æŸ¥æ•°å­—çš„å‡½æ•°
const hasNumber = curriedCheck(/\d+/g);

// åç»­è°ƒç”¨åªéœ€ä¼ å…¥å˜åŒ–çš„å‚æ•°
console.log(hasNumber('test')); // false
console.log(hasNumber('123'));  // true
console.log(hasNumber('abc'));  // false
```

é€šè¿‡æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªé€šç”¨å‡½æ•° `curriedCheck` å˜æˆäº†å¤šä¸ªä¸“ç”¨å‡½æ•°ï¼ˆå¦‚ `hasNumber`ï¼‰ï¼Œä½¿ä»£ç æ›´å…·å¯è¯»æ€§å’Œå¤ç”¨æ€§ã€‚

### 2\. æå‰ç¡®è®¤ (Early Confirmation)

æŸ¯é‡ŒåŒ–å¯ä»¥ç”¨äº**æå‰æ‰§è¡ŒæŸäº›é€»è¾‘**ï¼Œè¿”å›ä¸€ä¸ªå·²ç»â€œç¡®è®¤â€è¿‡ç¯å¢ƒçš„å‡½æ•°ï¼Œä»è€Œé¿å…åœ¨åç»­è°ƒç”¨ä¸­è¿›è¡Œé‡å¤çš„åˆ¤æ–­ã€‚

**åœºæ™¯**ï¼šå°è£…ä¸€ä¸ªè·¨æµè§ˆå™¨çš„äº‹ä»¶ç»‘å®šå‡½æ•°ï¼Œéœ€è¦åˆ¤æ–­æµè§ˆå™¨æ˜¯æ”¯æŒ `addEventListener` è¿˜æ˜¯ `attachEvent`ã€‚

```javascript
const on = (function() {
  // è¿™ä¸ªåˆ¤æ–­åªä¼šåœ¨ä»£ç åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡
  if (document.addEventListener) {
    // è¿”å›ä¸€ä¸ªå·²ç»ç¡®è®¤å¥½çš„å‡½æ•°
    return function(element, event, handler) {
      element.addEventListener(event, handler, false);
    };
  } else {
    // è¿”å›å¦ä¸€ä¸ªå·²ç»ç¡®è®¤å¥½çš„å‡½æ•°
    return function(element, event, handler) {
      element.attachEvent('on' + event, handler);
    };
  }
})();

// åç»­è°ƒç”¨ on å‡½æ•°æ—¶ï¼Œä¸å†éœ€è¦è¿›è¡Œ if/else åˆ¤æ–­
// const btn = document.getElementById('myBtn');
// on(btn, 'click', () => { console.log('clicked!'); });
```

è¿™ç§æ¨¡å¼ï¼ˆè™½ç„¶æ˜¯é€šè¿‡ IIFE å®ç°çš„ï¼Œä½†æ€æƒ³ä¸æŸ¯é‡ŒåŒ–ä¸€è‡´ï¼‰é€šè¿‡ä¸€æ¬¡æ€§çš„ç¯å¢ƒå—…æ¢ï¼Œé¿å…äº†æ¯æ¬¡è°ƒç”¨äº‹ä»¶ç»‘å®šæ—¶éƒ½æ‰§è¡Œif/elseåˆ¤æ–­ï¼Œæé«˜äº†è¿è¡Œæ•ˆç‡ã€‚

-----

## âš™ï¸ å°è£…ä¸€ä¸ªé€šç”¨çš„æŸ¯é‡ŒåŒ–å‡½æ•°

ä¸ºäº†é¿å…ä¸ºæ¯ä¸ªå‡½æ•°éƒ½æ‰‹åŠ¨ç¼–å†™æŸ¯é‡ŒåŒ–ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªé€šç”¨çš„ `curry` å‡½æ•°ã€‚

è¿™ä¸ª `curry` å‡½æ•°æ¥æ”¶ä¸€ä¸ªå¾…æŸ¯é‡ŒåŒ–çš„å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„æŸ¯é‡ŒåŒ–åçš„å‡½æ•°ã€‚

```javascript
function curry(fn, ...initialArgs) {
  // è·å–ç›®æ ‡å‡½æ•°æœŸæœ›çš„å‚æ•°ä¸ªæ•°
  const functionLength = fn.length;

  // é¢„å…ˆæ”¶é›†çš„å‚æ•°æ•°ç»„
  let args = initialArgs;

  // è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œç”¨äºæ”¶é›†å‚æ•°
  return function _curry(...newArgs) {
    // å°†æ–°ä¼ å…¥çš„å‚æ•°å’Œä¹‹å‰çš„å‚æ•°åˆå¹¶
    args = [...args, ...newArgs];

    // åˆ¤æ–­å½“å‰æ”¶é›†çš„å‚æ•°æ•°é‡æ˜¯å¦å·²è¾¾åˆ°ç›®æ ‡å‡½æ•°æ‰€éœ€æ•°é‡
    if (args.length >= functionLength) {
      // å¦‚æœå‚æ•°è¶³å¤Ÿï¼Œåˆ™æ‰§è¡ŒåŸå‡½æ•°å¹¶è¿”å›ç»“æœ
      return fn(...args);
    } else {
      // å¦‚æœå‚æ•°ä¸å¤Ÿï¼Œåˆ™è¿”å›è‡ªèº«ï¼Œç­‰å¾…æ¥æ”¶æ›´å¤šå‚æ•°
      return _curry;
    }
  };
}

// --- æµ‹è¯• ---

// 1. å®šä¹‰ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°
function add(a, b, c) {
  return a + b + c;
}

// 2. ä½¿ç”¨ curry å‡½æ•°å°†å…¶æŸ¯é‡ŒåŒ–
const curriedAdd = curry(add);

// 3. å¤šç§è°ƒç”¨æ–¹å¼
console.log(curriedAdd(1)(2)(3));   // è¾“å‡º: 6
console.log(curriedAdd(1, 2)(3));   // è¾“å‡º: 6
console.log(curriedAdd(1)(2, 3));   // è¾“å‡º: 6
```

-----

## ğŸ§  ç»å…¸é¢è¯•é¢˜

å®ç°ä¸€ä¸ª `add` å‡½æ•°ï¼Œä½¿å…¶èƒ½å¤Ÿæ»¡è¶³ä»¥ä¸‹æ‰€æœ‰è°ƒç”¨æ–¹å¼ï¼š

```javascript
add(1)(2)(3) == 6;
add(1, 2)(3) == 6;
add(1)(2, 3) == 6;
```

**åˆ†æ**ï¼šè¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äºï¼Œå‡½æ•°çš„å‚æ•°æ•°é‡æ˜¯ä¸å›ºå®šçš„ï¼Œå¹¶ä¸”éœ€è¦æœ‰ä¸€ç§æœºåˆ¶æ¥åœ¨æœ€åè§¦å‘è®¡ç®—ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‡½æ•°é“¾å¼è°ƒç”¨æ”¶é›†å‚æ•°ï¼Œå¹¶é€šè¿‡é‡å†™ `toString` æˆ– `valueOf` æ–¹æ³•ï¼Œåœ¨è¿›è¡Œæ¯”è¾ƒæˆ–ç±»å‹è½¬æ¢æ—¶éšå¼åœ°è§¦å‘æ±‚å’Œè®¡ç®—ã€‚

**å®ç°**ï¼š

```javascript
function add(...initialArgs) {
  // ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨æ‰€æœ‰ä¼ å…¥çš„å‚æ•°
  let allArgs = [...initialArgs];

  // å®šä¹‰å¹¶è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œç”¨äºç»§ç»­æ”¶é›†å‚æ•°
  function adder(...newArgs) {
    allArgs.push(...newArgs);
    // å…³é”®ï¼šè¿”å›è‡ªèº«ä»¥å®ç°é“¾å¼è°ƒç”¨
    return adder;
  }

  // é‡å†™ adder å‡½æ•°çš„ toString æ–¹æ³•
  // å½“ adder è¢«å°è¯•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆå¦‚ alert, console.logï¼‰æˆ–åŸå§‹å€¼ï¼ˆå¦‚ == æ¯”è¾ƒï¼‰æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨
  adder.toString = function() {
    // ä½¿ç”¨ reduce è®¡ç®—æ‰€æœ‰å‚æ•°çš„æ€»å’Œ
    return allArgs.reduce((sum, current) => sum + current, 0);
  };

  return adder;
}

// --- æµ‹è¯• ---
console.log(add(1)(2)(3).toString());      // 6
console.log(add(1, 2)(3).toString());      // 6
console.log(add(1)(2, 3)(4).toString()); // 10

// ä½¿ç”¨ == è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œè§¦å‘ toString
const result = add(1)(2)(3);
console.log(result == 6); // true
```